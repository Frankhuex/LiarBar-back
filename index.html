<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #connectionPanel {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #messageBox {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #fff;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .sent {
            background-color: #d1ecf1;
            text-align: right;
        }
        .received {
            background-color: #e9ecef;
        }
        .info {
            color: #6c757d;
            font-style: italic;
        }
        #messageInput {
            width: 70%;
            padding: 10px;
            font-size: 16px;
        }
        #sendButton {
            width: 25%;
            padding: 10px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        #connectButton {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }
        #userIdInput {
            padding: 10px;
            font-size: 16px;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>WebSocket Client Test</h1>
    
    <div id="connectionPanel">
        <!-- <label for="userIdInput">User ID:</label>
        <input type="text" id="userIdInput" placeholder="Enter your user ID"> -->
        <button id="connectButton" onclick="toggleConnection()">Connect</button>
    </div>
    
    <div id="messageBox"></div>
    
    <div>
        <input type="text" id="messageInput" placeholder="Type your message here..." disabled>
        <button id="sendButton" onclick="sendMessage()" disabled>Send</button>
    </div>

    <script>
        let websocket;
        let isConnected = false;

        function toggleConnection() {
            if (isConnected) {
                disconnect();
            } else {
                connect();
            }
        }

        function connect() {
            // const userId = document.getElementById('userIdInput').value;
            // if (!userId) {
            //     alert('Please enter a user ID');
            //     return;
            // }

            const userId = crypto.randomUUID();

            // 创建WebSocket连接
            const wsUrl = `ws://localhost:8080/api/ws/${userId}`;
            websocket = new WebSocket(wsUrl);

            websocket.onopen = function(event) {
                isConnected = true;
                document.getElementById('connectButton').textContent = 'Disconnect';
                // document.getElementById('userIdInput').disabled = true;
                document.getElementById('messageInput').disabled = false;
                document.getElementById('sendButton').disabled = false;
                addMessageToBox('Connected to WebSocket server', 'info');
            };

            websocket.onmessage = function(event) {
                addMessageToBox('Received: ' + event.data, 'received');
            };

            websocket.onclose = function(event) {
                isConnected = false;
                document.getElementById('connectButton').textContent = 'Connect';
                document.getElementById('userIdInput').disabled = false;
                document.getElementById('messageInput').disabled = true;
                document.getElementById('sendButton').disabled = true;
                addMessageToBox('Disconnected from WebSocket server', 'info');
            };

            websocket.onerror = function(error) {
                addMessageToBox('Error: ' + error, 'info');
            };
        }

        function disconnect() {
            if (websocket) {
                websocket.close();
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;

            if (!message) {
                alert('Please enter a message');
                return;
            }

            if (websocket && isConnected) {
                websocket.send(message);
                addMessageToBox('Sent: ' + message, 'sent');
                messageInput.value = '';
            } else {
                alert('Not connected to WebSocket server');
            }
        }

        function addMessageToBox(message, type) {
            const messageBox = document.getElementById('messageBox');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.textContent = message;
            messageBox.appendChild(messageElement);
            messageBox.scrollTop = messageBox.scrollHeight;
        }

        // 允许通过回车键发送消息
        document.getElementById('messageInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // 允许通过回车键连接
        document.getElementById('userIdInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                toggleConnection();
            }
        });
    </script>
</body>
</html>